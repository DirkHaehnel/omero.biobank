How to import data into VL
==========================


General strategy
----------------

Starting point
,,,,,,,,,,,,,,

We are expecting that every biosample will, at the end, link to an
individual. It can be a man, it can be a mouse, but there should be
one.  Therefore, the first

Loading along a chain
,,,,,,,,,,,,,,,,,,,,,





See ``tests/tools/importer`` for examples of input data files.

FIXME: add descriptions.

Common variables
----------------

.. code-block:: bash

    #!/bin/bash

    DEFAULT_STUDY=ILENIA3.41
    TDIR=~/svn/bl/vl/trunk/tools
    IMPORT="python ${TDIR}/importer"
    SERVER_OPTS="-H biobank05 -U root -P romeo"


Create SNP tables
-----------------
    
***NOTE:*** this operation is DESTRUCTIVE -- Activate it by adding ``--do-it``

.. code-block:: bash

    python ${TDIR}/create_snp_tables ${SERVER_OPTS} #--do-it

    
Import individuals
------------------

.. code-block:: bash
   
    ${IMPORT} ${SERVER_OPTS} -i individuals.tsv individual -S ${DEFAULT_STUDY}


Import biosamples
-----------------

.. code-block:: bash
    
    ${IMPORT} ${SERVER_OPTS} -i samples_blood_samples.tsv blood_sample \
      -S ${DEFAULT_STUDY}
    ${IMPORT} ${SERVER_OPTS} -i samples_dna_samples.tsv dna_sample \
      -S ${DEFAULT_STUDY}


Plate preparation
-----------------

.. code-block:: bash

    ${IMPORT} ${SERVER_OPTS} -i samples_titer_plates.tsv titer_plate \
      -S ${DEFAULT_STUDY}
    ${IMPORT} ${SERVER_OPTS} -i samples_plate_wells.tsv plate_well \
      -S ${DEFAULT_STUDY}


Import clinical data
--------------------

.. code-block:: bash

    ${IMPORT} ${SERVER_OPTS} -i samples_diagnosis.tsv diagnosis


Import digital data
-------------------

.. code-block:: bash

    ${IMPORT} ${SERVER_OPTS} -i samples_devices.tsv device
    ${IMPORT} ${SERVER_OPTS} -i samples_affy_gw.tsv data_sample


Import marker definitions
-------------------------

FIXME the importer will convert the input marker definition sequences
Illumina convention TOP strand FIXME ref. illumina techrep.

.. code-block:: bash

    ${IMPORT} ${SERVER_OPTS} -i Affymetrix_GenomeWideSNP_6_na28.tsv \
      marker_definition --source='Affymetrix' --context='GenomeWide-6.0' \
      --release='na28' -S ${DEFAULT_STUDY}


Import data objects
-------------------

Input tsv files are generated by ``chipal import_data``\ .
FIXME: cross-reference chipal docs.

.. code-block:: bash

    ${IMPORT} ${SERVER_OPTS} -i old_to_cels_20110704.tsv data_object \
      -S ${DEFAULT_STUDY}


Computing with omero/vl
-----------------------

Extract marker data for mapping to ref genome
FIXME: add more steps

.. code-block:: bash

    python ${TDIR}/kb_query -o markers.tsv ${SERVER_OPTS} markers \
      --definition-source="(Affymetrix,GenomeWide-6.0,na28)" \
      --fields-set=mapping
