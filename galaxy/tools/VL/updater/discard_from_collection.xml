<tool id="vl_updated_discard_from_collection" name="VLU.discard_from_collection">
  <description>
    Discard input elements from the selected collection
  </description>
  <command interpreter="python">
    discard_from_collection.py
    #if $advanced_configuration.configuration_level == 'advanced'
      --host=$advanced_configuration.vl_host
      --user=$advanced_configuration.vl_user
      --passwd=$advanced_configuration.vl_passwd
    #end if
    --loglevel=$__app__.config.vl_loglevel
    --logfile=${logfile}
    --ifile=${ifile}
    #if str($collection_selector.collection_type) != 'no_coll_selected'
      --collection_type=${collection_selector.collection_type}
      #if str($collection_selector.collection_type) == 'DataCollection'
        #if str($collection_selector.dcoll_label) != 'no_label_selected'
          --collection_label=${collection_selector.dcoll_label}
	#end if
      #elif str($collection_selector.collection_type) == 'VesselsCollection'
        #if str($collection_selector.vcoll_label) != 'no_label_selected'
          --collection_label=${collection_selector.vcoll_label}
	#end if
      #end if
    #end if
  </command>

  <inputs>
    <param format="tabular" name="ifile" type="data"
	   label="A tabular dataset with the following columns..."/>

    <conditional name="collection_selector">
      <param name="collection_type" type="select"
	     label="Collection Type">
	<option value="no_coll_selected">Select a Collection type...</option>
	<option value="DataCollection">Data Collection</option>
	<option value="VesselsCollection">Vessels Collection</option>
      </param>
      <when value="DataCollection">
	<param name="dcoll_label" type="select" label="Data Collection label"
	       help="Choose one of the already defined Data Collections.">
	  <options from_parameter="tool.app.known_data_collections"
		   transform_lines="[ &quot;%s%s%s&quot;
	                              % (l[1], self.separator, l[1])
				      for l in obj ]">
	    <column name="value" index="1"/>
	    <column name="name" index="0"/>
	    <filter type="sort_by" column="0"/>
	    <filter type="add_value" name="Select a Data Collection..."
		    value="no_label_selected" index="0"/>
	  </options>
	</param>
      </when>
      <when value="VesselsCollection">
	<param name="vcoll_label" type="select" label="Vessels Collection label"
	       help="Choose one of the already defined Vessels Collections.">
	  <options from_parameter="tool.app.known_vessels_collections"
		   transform_lines="[ &quot;%s%s%s&quot;
	                              % (l[1], self.separator, l[1])
				      for l in obj ]">
	    <column name="value" index="1"/>
	    <column name="name" index="0"/>
	    <filter type="sort_by" column="0"/>
	    <filter type="add_value" name="Select a Vessels Collection..."
		    value="no_label_selected" index="0"/>
	  </options>
	</param>
      </when>
    </conditional>

    <!-- ************************************************** -->
    <conditional name="advanced_configuration">
      <param name="configuration_level" type="select" 
	     label="Configuration level">
	<option value="default" selected="true">Default configuration</option>	
	<option value="advanced">Advanced configuration</option>
      </param>
      <when value="default"/>
      <when value="advanced">
	<param name="vl_host" size="40" type="text" value="biobank05.crs4.it" 
	       label="Omero/VL host"/>
	<param name="vl_user" size="20" type="text" value="galaxy" 
	       label="Omero/VL user"/>
	<param name="vl_passwd" size="20" type="text" value="What?Me worry?" 
	       label="Omero/VL passwd"/>
      </when>
    </conditional>
  </inputs>

  <outputs>
    <data format="txt" name="logfile" label="${tool.name}.logfile"/>
  </outputs>
</tool>