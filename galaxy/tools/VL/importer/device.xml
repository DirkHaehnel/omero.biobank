<tool id="vl_import_device" name="VLI.device">
  <description>import Device definitions within omero/vl</description>
  <command interpreter="python">
    #if $__app__.config.vl_import_enabled_users.split(',').count($__user_email__)==1 #importer.py
    #else #unauthorized_access.py
    #end if
    #if $advanced_configuration.configuration_level == 'advanced'
      --host=$advanced_configuration.vl_host
      --user=$advanced_configuration.vl_user
      --passwd=$advanced_configuration.vl_passwd
    #end if
    --operator=galaxy
    --ifile=$input1
    --ofile=$output1
    --loglevel=$__app__.config.vl_loglevel
    --logfile=${logfile}
    device
    #if str($study) != 'use_provided'
      --study ${study}
    #end if 
    #if str($device_type) != 'use_provided'
      --device-type=${device_type}
    #end if
    #if str($maker)
      --maker=${maker}
    #end if
    #if str($model)
      --model=${model}
    #end if
    #if str($release)
      --relese=${release}
    #end if
  </command>  
  <inputs>
    <param format="tabular" name="input1" type="data"
	   label="A tabular dataset with the following columns ..."/>

    <param name="study" type="select" label="Context study" 
	   help="Choose from the already defined studies. See below.">    
      <options from_parameter="tool.app.known_studies" 
	       transform_lines="[ &quot;%s%s%s:%s&quot; 
                                  % ( l[0], self.separator, l[0], l[1][:40] ) 
                                  for l in obj ]">
        <column name="value" index="0"/>
        <column name="name" index="1"/>
        <filter type="sort_by" column="0"/>
        <filter type="add_value" name="Records provide study labels" 
                value="use_provided" index="0"/>
      </options>
    </param>

    <param name="device_type" type="select"
	   label="type of the device"
	   help="Choose from the following. See below.">
      <option value="use_provided"       selected="true">
      Use record provided</option>
      <option value="Chip">Chip</option>
      <option value="Scanner">Scanner</option>
    </param>

    <param name="maker" size="40" type="text" value=""  label="Device maker"/>
    <param name="model" size="40" type="text" value=""  label="Device model"/>
    <param name="release" size="40" type="text" value="" 
	   label="Device release"/>

    <!-- ************************************************** -->
    <conditional name="advanced_configuration">
      <param name="configuration_level" type="select" 
	     label="Configuration level">
	<option value="default" selected="true">Default configuration</option>	
	<option value="advanced">Advanced configuration</option>
      </param>
      <when value="default"/>
      <when value="advanced">
	<param name="vl_host" size="40" type="text" value="localhost" 
	       label="Omero/VL host"/>
	<param name="vl_user" size="20" type="text" value="root" 
	       label="Omero/VL user"/>
	<param name="vl_passwd" size="20" type="text" value="What?Me worry?" 
	       label="Omero/VL passwd"/>
      </when>
    </conditional>
  </inputs>

  <outputs>
    <data format="tabular" name="output1" label="${tool.name}.mapping"/>
    <data format="txt" name="logfile"     label="${tool.name}.logfile"/>
  </outputs>
  <help>
Will read in a tsv file with the following columns::

  study  device_type    label   barcode maker model release location
  BSTUDY Scanner pula01  8989898 Affymetrix  GeneChip Scanner 3000 7G  Pula bld. 5
  BSTUDY Chip    chip001 8329482 Affymetrix  Genome-Wide Human SNP Array 6.0  None

All devices have a type, a label, an optional barcode, a maker, a
model, a release and an optional physical location. In the example
above, in the first line we have defined a scanner, which is
physically located in the building 5 lab in Pula.  The second line
defines a chip.
  </help>
</tool>
