<tool id="vl_import_seq_data_sample" name="VLI.seq_data_sample">
  <description>
    Import sequencing related DataSample definitions within omero/vl
  </description>
  <command interpreter="python">
    importer.py
    --operator=galaxy
    --ifile=${input}
    --ofile=${output}
    --report_file=$report
    --loglevel=$__app__.config.vl_loglevel
    --logfile=${logfile}
    seq_data_sample
    #if str($study) != 'use_provided'
      --study=${study}
    #end if
    #if str($source_type) != 'use_provided'
      --source-type=${source_type}
    #end if
    #if str($seq_dsample_type) != 'use_provided'
      --seq-dsample-type=${seq_dsample_type}
    #end if
    #if str($dsample_status) != 'use_provided'
      --status=${dsample_status}
    #end if
    #if str($device) != 'use_provided'
      --device=${device}
    #end if
  </command>
  <inputs>
    <param format="tabular" name="input" type="data"
	   label="A tabular dataset with the following columns..."/>

    <param name="study" type="select" label="Context study"
	   help="Choose from the already defined studies. See below.">
      <options from_parameter="tool.app.known_studies"
	       transform_lines="[ &quot;%s%s%s:%s&quot;
	                          % ( l[0], self.separator, l[0], l[1][:40] )
				  for l in obj ]">
	<column name="value" index="0"/>
	<column name="name" index="1"/>
	<filter type="sort_by" column="0"/>
	<filter type="add_value" name="Records provide study labels"
		value="use_provided" index="0"/>
      </options>
    </param>

    <param name="source_type" type="select"
	   label="Type of the source"
	   help="Choose from the following. See below.">
      <option value="use_provided" selected="true">
	Use record provided
      </option>
      <option value="FlowCell">FlowCell</option>
      <option value="SequencerOutput">
	SequencerOutput
      </option>
      <option value="RawSeqDataSample">
	RawSeqDataSample
      </option>
    </param>

    <!-- Choose the device after the type selection, SequencerOutput
	 will required an HardwareDevice, RawSeqDataSample and SeqDataSample
	 will required a SoftwareDevice. If the "use provided" is selected,
	 load a generic Device select list -->
    <param name="seq_dsample_type" type="select"
	   label="Type of the DataSample"
	   help="Choose from the following. See below.">
      <option value="use_provided" selected="true">
	Use record provided
      </option>
      <option value="SequencerOutput">
	SequencerOutput
      </option>
      <option value="RawSeqDataSample">
	RawSeqDataSample
      </option>
      <option value="SeqDataSample">
	SeqDataSample
      </option>
    </param>

    <param name="dsample_status" type="select" label="DataSample status"
	   help="Choose from one of the available values. See below.">
      <options from_parameter="tool.app.known_data_sample_status"
	       transform_lines="[ &quot;%s%s%s&quot;
	                          % (l[1], self.separator, l[1])
				  for l in obj ]">
	<column name="value" index="1"/>
	<column name="name" index="0"/>
	<filter type="sort_by" column="0"/>
	<filter type="add_value" name="Records provide status"
		value="use_provided" index="0"/>
      </options>
    </param>

    <param name="device" type="select" label="device"
	   help="Choose from the already defined devices. See below.">
      <options from_parameter="tool.app.known_devices"
	       transform_lines = "[ &quot;%s%s%s&quot;
	                            % ( l[0], self.separator, l[1])
				    for l in obj ]">
	<column name="value" index="0"/>
	<column name="name" index="1"/>
	<filter type="sort_by" column="1"/>
	<filter type="add_value" name="Records provide device ids"
		value="use_provided" index="0"/>
      </options>
    </param>

    <!-- ************************************************** -->
    <conditional name="wait_for_trigger">
      <param name="enable_trigger" type="boolean" checked="false"
	     label="Wait for another tool to end before running this tool"/>
      <when value="true">
	<param format="txt" name="trigger_file" type="data"
	       label="Select the LOG file that will be used as trigger"/>
      </when>
    </conditional>

    <conditional name="advanced_configuration">
      <param name="configuration_level" type="select" 
	     label="Configuration level">
	<option value="default" selected="true">Default configuration</option>	
	<option value="advanced">Advanced configuration</option>
      </param>
      <when value="default"/>
      <when value="advanced">
	<param name="vl_host" size="40" type="text" value="localhost" 
	       label="Omero/VL host"/>
	<param name="vl_user" size="20" type="text" value="root" 
	       label="Omero/VL user"/>
	<param name="vl_passwd" size="20" type="text" value="What? Me worry?" 
	       label="Omero/VL passwd"/>
      </when>
    </conditional>
  </inputs>

  <outputs>
    <data format="tabular" name="output" label="${tool.name}.mapping"/>
    <data format="tabular" name="report" label="${tool.name}.report"/>
    <data format="txt" name="logfile" label="${tool.name}.logfile"/>
  </outputs>
  <help>
    TODO: add doc....
  </help>
</tool>